#!/bin/bash

# Script simplificado para mostrar instrucciones de creaciÃ³n del Pipeline Job
set -euo pipefail

echo "=========================================="
echo "ğŸ¯ CÃ“MO CREAR EL PIPELINE JOB EN JENKINS"
echo "=========================================="
echo ""
echo "âŒ PROBLEMA IDENTIFICADO:"
echo "   El script Groovy NO se puede ejecutar en la consola de Jenkins"
echo "   La funciÃ³n 'pipeline()' solo funciona en Pipeline Jobs"
echo ""
echo "âœ… SOLUCIÃ“N: Crear un Pipeline Job"
echo ""
echo "=========================================="
echo "ğŸ“‹ INSTRUCCIONES PASO A PASO"
echo "=========================================="
echo ""
echo "ğŸŒ 1. Abrir Jenkins en el navegador:"
echo "   URL: http://20.8.71.3:8080"
echo "   Usuario: admin"
echo "   ContraseÃ±a: admin123"
echo ""
echo "â• 2. Crear nuevo item:"
echo "   - Click en 'New Item' (o 'Nuevo Elemento')"
echo "   - Nombre: error-testing-pipeline"
echo "   - Seleccionar: Pipeline"
echo "   - Click 'OK'"
echo ""
echo "âš™ï¸  3. Configurar parÃ¡metros:"
echo "   - Marcar âœ… 'This project is parameterized'"
echo ""
echo "   ğŸ“ ParÃ¡metro 1 - Choice Parameter:"
echo "      Name: ERROR_TYPE"
echo "      Choices (uno por lÃ­nea):"
echo "         ALL"
echo "         MEMORY" 
echo "         FILESYSTEM"
echo "         NETWORK"
echo "         CRASH"
echo "      Description: Tipo de error a simular"
echo ""
echo "   ğŸ“ ParÃ¡metro 2 - Boolean Parameter:"
echo "      Name: FORCE_FAILURE"
echo "      Default Value: false"
echo "      Description: Forzar que el pipeline falle"
echo ""
echo "   ğŸ“ ParÃ¡metro 3 - String Parameter:"
echo "      Name: DURATION_SECONDS"
echo "      Default Value: 30"
echo "      Description: DuraciÃ³n de cada etapa en segundos"
echo ""
echo "ğŸ“„ 4. Configurar el script:"
echo "   - En la secciÃ³n 'Pipeline':"
echo "   - Definition: Pipeline script"
echo "   - En el campo 'Script':"
echo ""
echo "     ğŸ“ Copiar TODO el contenido del archivo:"
echo "     $(pwd)/jenkins_error_testing_pipeline_fixed.groovy"
echo ""
echo "ğŸ’¾ 5. Guardar:"
echo "   - Click 'Save'"
echo ""
echo "ğŸš€ 6. Ejecutar:"
echo "   - Click 'Build with Parameters'"
echo "   - Seleccionar parÃ¡metros deseados"
echo "   - Click 'Build'"
echo ""
echo "=========================================="
echo "ğŸ“Š MONITOREO DESPUÃ‰S DE LA EJECUCIÃ“N"
echo "=========================================="
echo ""
echo "ğŸ“ˆ Dashboards de Grafana para verificar errores:"
echo "   - http://135.236.73.36/d/f50a7480-4ff6-4f08-b287-63daea6d00ae"
echo "   - http://135.236.73.36/d/ca7aa68f-5b77-4205-a6cb-b2f7133966f2"
echo ""
echo "ğŸ” Comandos para verificar:"
echo "   kubectl get pods -n testing-errors"
echo "   kubectl logs -f -n testing-errors deployment/log-generator"
echo ""
echo "=========================================="
echo "ğŸ“ ARCHIVOS DISPONIBLES"
echo "=========================================="
echo ""
ls -la *pipeline*.groovy 2>/dev/null || echo "No hay archivos pipeline en el directorio actual"
echo ""
echo "ğŸ“ Para ver el contenido del pipeline:"
echo "   cat jenkins_error_testing_pipeline_fixed.groovy"
